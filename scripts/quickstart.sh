#!/bin/bash

set -e

cat << "EOF"
â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘                                                                      â•‘
â•‘   â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—  â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•— â–ˆâ–ˆâ–ˆâ•—   â–ˆâ–ˆâ•— â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—â–ˆâ–ˆâ•—  â–ˆâ–ˆâ•—â–ˆâ–ˆâ•—   â–ˆâ–ˆâ•—â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•— â•‘
â•‘   â–ˆâ–ˆâ•”â•â•â–ˆâ–ˆâ•—â–ˆâ–ˆâ•”â•â•â–ˆâ–ˆâ•—â–ˆâ–ˆâ–ˆâ–ˆâ•—  â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•”â•â•â•â•â•â–ˆâ–ˆâ•”â•â•â•â•â•â–ˆâ–ˆâ•‘  â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•‘   â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•”â•â•â–ˆâ–ˆâ•—â•‘
â•‘   â–ˆâ–ˆâ•‘  â–ˆâ–ˆâ•‘â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•‘â–ˆâ–ˆâ•”â–ˆâ–ˆâ•— â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•‘     â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—  â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•‘â–ˆâ–ˆâ•‘   â–ˆâ–ˆâ•‘â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•”â•â•‘
â•‘   â–ˆâ–ˆâ•‘  â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•”â•â•â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•‘â•šâ–ˆâ–ˆâ•—â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•‘     â–ˆâ–ˆâ•”â•â•â•  â–ˆâ–ˆâ•”â•â•â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•‘   â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•”â•â•â–ˆâ–ˆâ•—â•‘
â•‘   â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•”â•â–ˆâ–ˆâ•‘  â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•‘ â•šâ–ˆâ–ˆâ–ˆâ–ˆâ•‘â•šâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—â–ˆâ–ˆâ•‘  â–ˆâ–ˆâ•‘â•šâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•”â•â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•”â•â•‘
â•‘   â•šâ•â•â•â•â•â• â•šâ•â•  â•šâ•â•â•šâ•â•  â•šâ•â•â•â• â•šâ•â•â•â•â•â•â•šâ•â•â•â•â•â•â•â•šâ•â•  â•šâ•â• â•šâ•â•â•â•â•â• â•šâ•â•â•â•â•â• â•‘
â•‘                                                                      â•‘
â•‘                    ğŸš€ Quick Start Setup Script                      â•‘
â•‘                                                                      â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
EOF

echo ""
echo "This script will set up your DanceHub development environment."
echo ""
echo "Prerequisites:"
echo "  âœ… Docker Desktop installed and running"
echo "  âœ… Node.js 18+ installed"
echo "  âœ… pnpm installed (npm install -g pnpm)"
echo ""
read -p "Press Enter to continue or Ctrl+C to cancel..."

# Colors
GREEN='\033[0;32m'
BLUE='\033[0;34m'
YELLOW='\033[1;33m'
NC='\033[0m' # No Color

echo ""
echo -e "${BLUE}ğŸ“¦ Step 1/5: Installing dependencies...${NC}"
pnpm install

echo ""
echo -e "${BLUE}ğŸ³ Step 2/5: Starting Docker services...${NC}"
docker-compose up -d

echo ""
echo -e "${BLUE}â³ Step 3/5: Waiting for services to be ready...${NC}"
sleep 5

# Check if services are healthy
echo "  Checking PostgreSQL..."
until docker exec dancehub-postgres pg_isready -U dancehub > /dev/null 2>&1; do
    echo "    Waiting..."
    sleep 2
done
echo "  âœ… PostgreSQL ready"

echo "  Checking Redis..."
until docker exec dancehub-redis redis-cli ping > /dev/null 2>&1; do
    echo "    Waiting..."
    sleep 2
done
echo "  âœ… Redis ready"

echo ""
echo -e "${BLUE}ğŸ“ Step 4/5: Setting up environment files...${NC}"
if [ ! -f apps/api/.env ]; then
    cp apps/api/.env.example apps/api/.env
    echo "  âœ… Created apps/api/.env"
else
    echo "  âš ï¸  apps/api/.env already exists (skipping)"
fi

if [ ! -f apps/web/.env.local ]; then
    echo "NEXT_PUBLIC_API_URL=http://localhost:4000" > apps/web/.env.local
    echo "  âœ… Created apps/web/.env.local"
else
    echo "  âš ï¸  apps/web/.env.local already exists (skipping)"
fi

echo ""
echo -e "${BLUE}ğŸ—„ï¸  Step 5/5: Setting up database...${NC}"
cd apps/api && pnpm db:push
cd ../..

echo ""
echo -e "${GREEN}â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—${NC}"
echo -e "${GREEN}â•‘                                                                â•‘${NC}"
echo -e "${GREEN}â•‘                  âœ… Setup Complete!                            â•‘${NC}"
echo -e "${GREEN}â•‘                                                                â•‘${NC}"
echo -e "${GREEN}â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•${NC}"
echo ""
echo -e "${BLUE}ğŸ¯ Next Steps:${NC}"
echo ""
echo "  1. Start development:"
echo -e "     ${YELLOW}pnpm dev${NC}"
echo ""
echo "  2. Or start services individually:"
echo -e "     ${YELLOW}cd apps/api && pnpm dev${NC}  (API)"
echo -e "     ${YELLOW}cd apps/web && pnpm dev${NC}  (Web)"
echo ""
echo -e "${BLUE}ğŸ“š Useful Commands:${NC}"
echo ""
echo -e "  ${YELLOW}make help${NC}           - Show all available commands"
echo -e "  ${YELLOW}make health${NC}         - Check service health"
echo -e "  ${YELLOW}make db-studio${NC}      - Open database UI"
echo -e "  ${YELLOW}pnpm test${NC}           - Run tests"
echo ""
echo -e "${BLUE}ğŸŒ Services:${NC}"
echo ""
echo "  â€¢ API:       http://localhost:4000"
echo "  â€¢ Swagger:   http://localhost:4000/docs"
echo "  â€¢ Web:       http://localhost:3000"
echo "  â€¢ MailHog:   http://localhost:8025  (docker-compose --profile mail up -d)"
echo "  â€¢ MinIO:     http://localhost:9001  (docker-compose --profile storage up -d)"
echo ""
echo -e "${GREEN}Happy coding! ğŸš€${NC}"
echo ""
